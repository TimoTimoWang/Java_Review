
平均CPU的使用率=1-（空闲时间new-空闲时间old）/（总CPU时间new-总CPU时间Old）

 /proc/stat 提供的就 是系统的 CPU 和任务统计信息.
 
 /proc/[pid]/stat可以查看每个进程的运行情况。
 
 perf 是 Linux 2.6.31 以后内置的性能分析工具。它以性能事件采样为基础，不仅可以分析系统的各种事件和内核性 能，还可以用来分析指定应用程序的性能问题。
 
 当系统CPU使用率升高，但又没有办法通过top等命令查看到是哪一个进程升高的时候，这时CPU的使用率就不太正常，一般情况下导致这种情况的原因是短时应用所导致。
 1. 应用中调用了外部的大量二进制程序，这些程序的运行时间又比较短，因此不容易被top命令查看出来。
 2. 程序因为某种原因不短的崩溃重启，而启动过程中资源初始化，很可能会占用相当多的CPU。
 
 ##### 排查的办法：
**1.使用per工具**

 ```
  记录性能事件，等待大约15秒后按 Ctrl+C 退出
  $ perf record -g
  查看报告
  $ perf report
```
**2. execsnoop工具**

execsnoop 就是一个专为短时进程设计的工具。它通过 ftrace 实时监控进程的 exec() 行为，并输出短时进程的基本信息，包括进程PID、父进程 PID、命令行参数以及执行的结果。

#### IO等待CPU的使用率升高，既iowait升高怎么办？

1. 孤儿进程：一个父进程退出，而它的一个或多个子进程还在运行，那么那些子进程将成为孤儿进程。孤儿进程将被init进程(进程号为1)所收养，并由init进程对它们完成状态收集工作。
2. 僵尸进程：一个进程使用fork创建子进程，如果子进程退出，而父进程并没有调用wait或waitpid获取子进程的状态信息，那么子进程的进程描述符仍然保存在系统中。这种进程称之为僵死进程

1. 僵尸进程持续的时间都比较短，在父进程回收它的资源后就会消亡;或者在父进程退出 后，由 init 进程回收后也会消亡。
2. 一旦父进程没有处理子进程的终止，还一直保持运行状态，那么子进程就会一直处于僵尸状态。 大量的僵尸进程会用尽 PID 进程号，导致新进程不能创建
 
 使用top命令打印出的信息中，`S`栏表示进程status状态，以下是进程的几种状态：
- R 是 Running 或 Runnable 的缩写，表示进程在 CPU 的就绪队列中，正在运行或者正在等待 运行。
- D 是 Disk Sleep 的缩写，也就是不可中断状态睡眠(Uninterruptible Sleep)，一般表示进程 正在跟硬件交互，并且交互过程不允许被其他进程或中断打断。
- Z 是 Zombie 的缩写，如果你玩过“植物大战僵尸”这款游戏，应该知道它的意思。它表示僵尸 进程，也就是进程实际上已经结束了，但是父进程还没有回收它的资源(比如进程的描述 符、PID 等)。
- S 是 Interruptible Sleep 的缩写，也就是可中断状态睡眠，表示进程因为等待某个事件而被系 统挂起。当进程等待的事件发生时，它会被唤醒并进入 R 状态。
- I 是 Idle 的缩写，也就是空闲状态，用在不可中断睡眠的内核线程上。前面说了，硬件交互导 致的不可中断进程用 D 表示，但对某些内核线程来说，它们有可能实际上并没有任何负载， 用 Idle 正是为了区分这种情况。要注意，D 状态的进程会导致平均负载升高， I 状态的进程 却不会。
- T 或者 t，也就是 Stopped 或 Traced 的缩写，表示进程处于暂停或者跟踪状态。向一个进程发送 SIGSTOP信号，它就会因响应这个信号变成暂停状态(Stopped);再向它发 送 SIGCONT 信号，进程又会恢复运行(如果进程是终端里直接启动的，则需要你用 fg 命令， 恢复到前台运行)。
- X，也就是 Dead 的缩写，表示进程已经消亡，所以你不会在 top 或者 ps命令中看到它。

当使用ps等工具查看进程的使用状况的时候，如果状态是Ss+或者D+，其中，S表示可中断睡眠状态，D表示不可中断睡眠状态，s表示这一个进程是会话领导进程，+表示领导进程。

- 会话：指共享同一个终端的一个或者多个进程组。
- 进程组表示一组相互关联的进程，比如父进程的所有子进程就是一个进程组。

比如，我们通过 SSH 登录服务器，就会打开一个控制终端(TTY)，这个控制终端就对应一个 会话。而我们在终端中运行的命令以及它们的子进程，就构成了一个个的进程组，其中，在后台 运行的命令，构成后台进程组;在前台运行的命令，构成前台进程组。


 
 
 
